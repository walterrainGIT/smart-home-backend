syntax = "proto3";

package market;

import "pagination.proto"; // Импортируем общую пагинацию
import "user.proto"; // Импортируем общего пользователя

// Определение сервиса для работы с лотами, продуктами и заказами
service MarketService {
  rpc CreateLot(CreateLotRequest) returns (Lot);          // Создать лот
  rpc CreateProduct(CreateProductRequest) returns (Product); // Создать продукт
  rpc GetProducts(GetProductsRequest) returns (GetProductsResponse); // Получить список продуктов
  rpc GetLots(GetLotsRequest) returns (GetLotsResponse);   // Получить список лотов

  rpc DeleteLot(DeleteLotRequest) returns (Lot);          // Удалить лот
  rpc UpdateLot(UpdateLotRequest) returns (Lot);          // Обновить лот
  rpc DeleteProduct(DeleteProductRequest) returns (Product); // Удалить продукты
  rpc UpdateProduct(UpdateProductRequest) returns (Product); // Обновить продукт

  rpc GetOrders(GetOrdersRequest) returns (GetOrdersResponse); // Получить список заказов
  rpc CreateOrder(CreateOrderRequest) returns (Order); // Создать заказ
  rpc UpdateOrder(UpdateOrderRequest) returns (Order); // Обновить заказ
  rpc CancelOrder(CancelOrderRequest) returns (Order); // Отменить заказ

  // Методы аналитики
  rpc GetOrdersSummary(GetOrdersSummaryRequest) returns (OrdersSummaryResponse); // Статистика по заказам
  rpc GetOrdersByPeriod(GetOrdersByPeriodRequest) returns (GetOrdersByPeriodResponse); // Заказы по периодам
  rpc GetPopularLots(GetPopularLotsRequest) returns (GetPopularLotsResponse); // Популярные лоты
  rpc GetTopCustomers(GetTopCustomersRequest) returns (GetTopCustomersResponse); // Топ клиентов

  // Методы конфигуратора
  rpc SaveConfiguration(SaveConfigurationRequest) returns (Configuration); // Сохранить конфигурацию
  rpc GetConfigurations(GetConfigurationsRequest) returns (GetConfigurationsResponse); // Получить конфигурации
  rpc DeleteConfiguration(DeleteConfigurationRequest) returns (Configuration); // Удалить конфигурацию
}

// Запрос на создание продукта
message CreateProductRequest {
  string name = 1;                 // Название
  string shortDescription = 2;     // Краткое описание (необязательно)
  string description = 3;          // Описание (необязательно)
  string image = 4;                // Изображение (необязательное)
  int32 price = 5;                 // Цена
}

// Запрос на создание лота
message CreateLotRequest {
  string name = 1;                 // Название лота (обязательное)
  string shortDescription = 2;     // Краткое описание лота (необязательно)
  string description = 3;          // Описание лота (необязательно)
  string image = 4;                // Изображение лота (необязательно)
  string type = 5;                 // Тип лота (обязательное)
  repeated int32 productsIds = 6;  // Идентификаторы продуктов (обязательное)
}

// Запрос на получение списка продуктов
message GetProductsRequest {
  pagination.Pagination pagination = 1; // Параметры пагинации
}

// Ответ на запрос списка продуктов
message GetProductsResponse {
  repeated Product products = 1;           // Список продуктов
  pagination.PaginationResponse metadata = 2; // Метаданные пагинации
}

// Запрос на получение списка лотов
message GetLotsRequest {
  repeated string types = 1;    // Массив типов лотов (опционально)
  repeated string statuses = 2; // Массив статусов лотов (опционально)
  pagination.Pagination pagination = 3; // Параметры пагинации
}

// Ответ на запрос списка лотов
message GetLotsResponse {
  repeated Lot lots = 1;                  // Список лотов
  pagination.PaginationResponse metadata = 2; // Метаданные пагинации
}

// Запрос на удаление лота
message DeleteLotRequest {
  int32 id = 1;  // Идентификатор лота, который нужно удалить
}

// Запрос на обновление лота
message UpdateLotRequest {
  int32 id = 1;                    // Идентификатор лота
  string name = 2;                 // Название лота (опционально)
  string shortDescription = 3;     // Краткое описание лота (необязательно)
  string description = 4;          // Описание лота (необязательно)
  double price = 5;                // Цена лота (необязательно)
  string image = 6;                // Изображение лота (необязательно)
  string type = 7;                 // Тип лота (необязательно)
  string status = 8;               // Статус лота (необязательно)
  repeated int32 productsIds = 9;  // Список идентификаторов продуктов (необязательно)
}

// Запрос на удаление продуктов
message DeleteProductRequest {
  int32 id = 1;  // Список идентификаторов продуктов для удаления
}

// Запрос на обновление продукта
message UpdateProductRequest {
  int32 id = 1;                    // Идентификатор продукта
  string name = 2;                 // Название продукта (опционально)
  string shortDescription = 3;     // Краткое описание продукта (необязательно)
  string description = 4;          // Описание продукта (необязательно)
  double price = 5;                // Цена продукта (необязательно)
  string image = 6;                // Изображение продукта (необязательно)
}

// Запрос на получение списка заказов
message GetOrdersRequest {
  repeated int32 ids = 1;               // Идентификаторы заказов (необязательно)
  repeated int32 usersIds = 2;          // Идентификаторы пользователей (необязательно)
  repeated string statuses = 3;          // Статусы заказов (необязательно)
  repeated int32 lotsIds = 4;           // Идентификаторы лотов (необязательно)
  pagination.Pagination pagination = 5; // Параметры пагинации
}

// Ответ на запрос списка заказов
message GetOrdersResponse {
  repeated Order orders = 1;                // Список заказов
  pagination.PaginationResponse metadata = 2; // Метаданные пагинации
}

// Запрос на создание заказа
message CreateOrderRequest {
  int32 userId = 1;  // Идентификатор пользователя
  int32 lotId = 2;   // Идентификатор лота
}

// Запрос на обновление заказа
message UpdateOrderRequest {
  int32 id = 1;                    // Идентификатор заказа
  int32 userId = 2;                // Идентификатор пользователя (необязательно)
  int32 lotId = 3;                 // Идентификатор лота (необязательно)
  string status = 4;               // Статус заказа (необязательно)
}

// Запрос на отмену заказа
message CancelOrderRequest {
  int32 id = 1;                    // Идентификатор заказа
  int32 userId = 2;                // Идентификатор пользователя (необязательно)
}

// Заказ
message Order {
  int32 id = 1;                    // Идентификатор заказа
  int32 userId = 2;                // Идентификатор пользователя
  string status = 3;               // Статус заказа
  Lot lot = 4;                     // Лот, связанный с заказом
  string createdAt = 5;            // Дата создания заказа
  user.UserResponse user = 6; // Данные пользователя
}

// Лот
message Lot {
  int32 id = 1;                    // Идентификатор лота
  string name = 2;                 // Название
  string shortDescription = 3;     // Краткое описание (необязательно)
  string description = 4;          // Описание (необязательно)
  double price = 5;                // Цена (необязательно)
  string image = 6;                // Изображение (необязательно)
  string type = 7;                 // Тип лота
  string status = 8;               // Статус лота
  repeated Product products = 9;   // Список продуктов (если необходимо)
}

// Продукт
message Product {
  int32 id = 1;                    // Идентификатор продукта
  string name = 2;                 // Название
  string shortDescription = 3;     // Краткое описание (необязательно)
  string description = 4;          // Описание (необязательно)
  double price = 5;                // Цена (необязательно)
  string image = 6;                // Изображение (необязательно)
}

// Запрос статистики по заказам
message GetOrdersSummaryRequest {
  string dateFrom = 1;  // Дата начала (необязательно)
  string dateTo = 2;    // Дата окончания (необязательно)
}

// Ответ статистики по заказам
message OrdersSummaryResponse {
  int32 totalOrders = 1;           // Общее количество заказов
  OrdersByStatus ordersByStatus = 2; // Заказы по статусам
  double totalRevenue = 3;          // Общий доход
  double averageOrderValue = 4;     // Средний чек
}

message OrdersByStatus {
  int32 created = 1;
  int32 progress = 2;
  int32 completed = 3;
  int32 canceled = 4;
}

// Запрос заказов по периодам
message GetOrdersByPeriodRequest {
  string dateFrom = 1;  // Дата начала
  string dateTo = 2;    // Дата окончания
  string period = 3;    // Период: day, week, month
}

// Ответ заказов по периодам
message GetOrdersByPeriodResponse {
  repeated OrderPeriodData data = 1;
}

message OrderPeriodData {
  string period = 1;  // Период
  int32 count = 2;    // Количество
  double revenue = 3; // Доход
}

// Запрос популярных лотов
message GetPopularLotsRequest {
  int32 limit = 1;      // Лимит (необязательно)
  string dateFrom = 2;  // Дата начала (необязательно)
  string dateTo = 3;    // Дата окончания (необязательно)
}

// Ответ популярных лотов
message GetPopularLotsResponse {
  repeated PopularLot lots = 1;
}

message PopularLot {
  int32 lotId = 1;
  string lotName = 2;
  int32 orderCount = 3;
  double revenue = 4;
  double conversionRate = 5;
}

// Запрос топ клиентов
message GetTopCustomersRequest {
  int32 limit = 1;      // Лимит (необязательно)
  string dateFrom = 2;  // Дата начала (необязательно)
  string dateTo = 3;    // Дата окончания (необязательно)
}

// Ответ топ клиентов
message GetTopCustomersResponse {
  repeated TopCustomer customers = 1;
}

message TopCustomer {
  int32 userId = 1;
  int32 orderCount = 2;
  double totalSpent = 3;
}

// Запрос сохранения конфигурации
message SaveConfigurationRequest {
  int32 userId = 1;           // Идентификатор пользователя
  repeated Room rooms = 2;    // Комнаты
  string name = 3;           // Название (необязательно)
}

// Комната в конфигурации
message Room {
  int32 id = 1;              // Идентификатор комнаты
  string type = 2;           // Тип комнаты
  string name = 3;           // Название
  repeated int32 products = 4; // Идентификаторы продуктов
}

// Конфигурация
message Configuration {
  int32 id = 1;              // Идентификатор конфигурации
  int32 userId = 2;          // Идентификатор пользователя
  repeated Room rooms = 3;   // Комнаты
  double totalPrice = 4;     // Общая стоимость
  string name = 5;           // Название
  string createdAt = 6;      // Дата создания
}

// Запрос получения конфигураций
message GetConfigurationsRequest {
  int32 userId = 1;  // Идентификатор пользователя
}

// Ответ получения конфигураций
message GetConfigurationsResponse {
  repeated Configuration configurations = 1;
}

// Запрос удаления конфигурации
message DeleteConfigurationRequest {
  int32 id = 1;      // Идентификатор конфигурации
  int32 userId = 2; // Идентификатор пользователя
}
